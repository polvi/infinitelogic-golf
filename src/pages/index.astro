---
import StreamingResponse from '../components/StreamingResponse.astro';

// Get query from URL params for streaming
const url = new URL(Astro.request.url);
const query = url.searchParams.get('q') || '';
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>AutoRAG Streaming Demo</title>
		<style>
			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
				max-width: 800px;
				margin: 0 auto;
				padding: 20px;
				line-height: 1.6;
			}
			.container {
				background: #f9f9f9;
				padding: 20px;
				border-radius: 8px;
				margin-bottom: 20px;
			}
			button {
				background: #0066cc;
				color: white;
				border: none;
				padding: 10px 20px;
				border-radius: 4px;
				cursor: pointer;
				font-size: 16px;
			}
			button:hover {
				background: #0052a3;
			}
			button:disabled {
				background: #ccc;
				cursor: not-allowed;
			}
			input[type="text"] {
				width: 100%;
				padding: 10px;
				border: 1px solid #ddd;
				border-radius: 4px;
				font-size: 16px;
				margin-bottom: 10px;
			}
			.placeholder {
				background: white;
				border: 1px solid #ddd;
				border-radius: 4px;
				padding: 15px;
				min-height: 100px;
				color: #666;
				font-style: italic;
			}
			.loading {
				color: #666;
				font-style: italic;
			}
			.error {
				color: #d32f2f;
				background: #ffebee;
				padding: 10px;
				border-radius: 4px;
			}
		</style>
	</head>
	<body>
		<h1>AutoRAG Streaming Demo</h1>
		<p>This demo shows streaming responses from your <code>aopa-rag</code> AutoRAG instance.</p>
		
		<div class="container">
			<form method="GET" action="/">
				<input type="text" name="q" id="question" placeholder="Enter your question..." value={query || "What are the key topics in the knowledge base?"} />
				<button type="submit">Ask Question</button>
			</form>
		</div>
		
		<div class="container">
			<h3>Response:</h3>
			{query ? (
				<StreamingResponse query={query} />
			) : (
				<div class="placeholder">Enter a question above to see a streaming response...</div>
			)}
		</div>

	</body>
</html>
